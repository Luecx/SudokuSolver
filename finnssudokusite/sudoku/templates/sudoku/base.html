{% load form_filters %}
{% load i18n %}
{% load static %}
{% load widget_tweaks %}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>{% block title %}Sudoku{% endblock %}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="csrf-token" content="{{ csrf_token }}">
	<link rel="shortcut icon" href="{% static 'icons/favicon.ico' %}" type="image/x-icon">
	<link rel="apple-touch-icon" sizes="180x180" href="{% static 'icons/apple-touch-icon.png' %}">
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="{% static 'icons/apple-touch-icon-precomposed.png' %}">
	
	<!-- Bootstrap -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	
	<!-- Font Awesome -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'sudoku/css/style.css' %}">
	
	{% block extra_css %}
	{% endblock %}

</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg my_navColors" style="z-index: 1000">
	<div class="container-fluid">
		<a class="navbar-brand" href="/">
			<img src="{% static 'sudoku/img/brain-white-32.png' %}" alt="Logo" width="32" height="32" class="align-middle me-2">
			{% trans "Finn's Sudoku App" %}
		</a>
		<button class="navbar-toggler btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
			<span class="navbar-toggler-icon"></span>
		</button>
		
		<div class="collapse navbar-collapse" id="navbarNav">
			<ul class="navbar-nav me-auto mb-2 mb-lg-0">
				<li class="nav-item">
					<a class="nav-link" href="{% url 'game_selection' %}">
						<i class="fas fa-trophy"></i>{% trans "Play" %}
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="{% url 'puzzles' %}">
						<i class="fas fa-th-list"></i>{% trans "Puzzles" %}
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="{% url 'leaderboard' %}">
						<i class="fas fa-trophy"></i>{% trans "Leaderboards" %}
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="{% url 'creator' %}">
						<i class="fas fa-pencil-alt"></i>{% trans "Sudoku Creator" %}
					</a>
				</li>
			</ul>
			
			<ul class="navbar-nav ms-auto">
				
				<!-- Sprachumschaltung -->
				{% get_current_language as LANGUAGE_CODE %}
				<li class="nav-item dropdown">
					<a class="nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
						<i class="fas fa-globe"></i>
					</a>
					<ul id="languageDropdownMenu" class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
						<li>
							<button class="dropdown-item lang-btn{% if LANGUAGE_CODE == 'en' %} bg-secondary text-white{% endif %}" data-lang="en">English</button>
						</li>
						<li>
							<button class="dropdown-item lang-btn{% if LANGUAGE_CODE == 'de' %} bg-secondary text-white{% endif %}" data-lang="de">Deutsch</button>
						</li>
						<li>
							<button class="dropdown-item lang-btn{% if LANGUAGE_CODE == 'ja' %} bg-secondary text-white{% endif %}" data-lang="ja">日本語</button>
						</li>
					</ul>
				</li>
				
				<!-- USER -->
				{% if user.is_authenticated %}
				<li class="nav-item dropdown">
					<a class="nav-link" id="userDropdown" href="{% url 'profile' %}" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-user"></i></a>
					
					<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
						<li class="infotext">{{ user.username }}</li>
						<hr>
						<li>
							<a class="dropdown-item" href="{% url 'profile' %}"><i class="fas fa-user"></i>{% trans "Your profile" %}</a>
						</li>
						<li>
							<form method="post" action="{% url 'logout' %}" class="m-0">
								{% csrf_token %}
								<button type="submit" class="dropdown-item">
									<i class="fas fa-sign-out-alt"></i>{% trans "Logout" %}
								</button>
							</form>
						</li>
					</ul>
				</li>
				{% else %}
				<li class="nav-item">
					<a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal" onclick="openLoginModal()">
						<i class="fas fa-sign-in-alt"></i> {% trans "Login" %}
					</a>
				</li>
				{% endif %}
			</ul>
			<!-- Unsichtbares Formular für die Sprachumschaltung -->
			<form id="languageForm" method="post" action="{% url 'set_language' %}" style="display: none;">
				{% csrf_token %}
				<input type="hidden" name="language" id="languageInput">
				<input type="hidden" name="next" value="{{ request.path }}">
			</form>
		
		</div>
	</div>
</nav>

<!-- Main content -->
{% block container %}
<div class="container mt-4">
	{% block content %}{% endblock %}
</div>
{% endblock %}


<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content border rounded-5 shadow-sm">
			<div id="modalContentContainer" class="modal-body p-4">
				<h3 class="card-title text-center mb-4">Login</h3>
				<form method="post" action="{% url 'login' %}" novalidate>
					{% csrf_token %}
					{% if login_form.non_field_errors %}
					<div class="alert alert-danger">
						{{ login_form.non_field_errors }}
					</div>
					{% endif %}
					
					{% for field in login_form %}
					<div class="mb-2">
						{% if field.name == "username" %}
						<label for="{{ field.id_for_label }}" class="form-label m-0">Username or Email</label>
						{% else %}
						<label for="{{ field.id_for_label }}" class="form-label m-0">{{ field.label }}</label>
						{% endif %}
						{{ field|add_class:"form-control" }}
						{% if field.help_text %}
						<div class="form-text">{{ field.help_text }}</div>
						{% endif %}
						{% for error in field.errors %}
						<div class="invalid-feedback d-block">{{ error }}</div>
						{% endfor %}
					</div>
					{% endfor %}
					
					<button type="submit" class="btn btn-primary w-100 mt-2">Log In</button>
				</form>
				<div class="col-auto d-flex justify-content-center mt-2">
					<a class="link link--io my-text-btn" href="#" onclick="switchModalContent('{% url 'password_reset' %}')">{% trans "Forgot your password?" %}</a>
				</div>
				<hr class="my-4">
				<div class="d-flex align-items-center justify-content-center gap-3 mt-2">
					<span class="text-nowrap">Sign in with...</span>
					<button type="button" class="btn btn-link d-flex align-items-center border shadow-sm">
						<img src="{% static 'sudoku/img/login/loginSign-google.svg' %}" alt="Google" width="30" class="me-2">
					</button>
					<button type="button" class="btn btn-link d-flex align-items-center border shadow-sm">
						<img src="{% static 'sudoku/img/login/loginSign-Apple.svg' %}" alt="Apple" width="30" class="me-2">
					</button>
					<button type="button" class="btn btn-link d-flex align-items-center border shadow-sm">
						<img src="{% static 'sudoku/img/login/loginSign-facebook.svg' %}" alt="Facebook" width="30" class="me-2">
					</button>
				</div>
				<div class="text-center mt-3">
					<a class="link link--io my-text-btn" href="#" onclick="switchModalContent('{% url 'register' %}','L')">{% trans "No account yet? Register now" %}</a>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

{% block extra_scripts %}
<!-- zusätzliche Scripts hier -->
{% endblock %}

<script src="{% static 'sudoku/js/base_loginModal.js' %}"></script>

</body>
</html>

