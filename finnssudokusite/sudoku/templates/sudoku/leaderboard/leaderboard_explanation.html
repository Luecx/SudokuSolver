{% load i18n %}

<div class="modal-body px-4 py-3">
    <p>
        {% blocktrans %}
        The leaderboard uses the
        <strong>Sudoku Power Index (SPI)</strong> — a score from 0 to 100 that rewards
        <em>fast</em> solves on <em>difficult</em> puzzles, values
        <em>recency</em>, and favors consistent performance.
        {% endblocktrans %}
    </p>

    <hr class="my-4">

    <h6 class="fw-bold mb-2">{% trans "Per‑puzzle contribution" %}</h6>
    <p>
        {% blocktrans %}
        Each time you solve a puzzle, you earn a score \( S_{u,s} \) that reflects your relative performance:
        {% endblocktrans %}
    </p>

    <div class="text-center mb-3">
        <p class="text-primary">\[\displaystyle S_{u,s} = \bar{t}_s \cdot \frac{\bar{t}_s}{t_{u,s}}\]</p>
    </div>

    <p>
        {% blocktrans %}
        The reward \( S_{u,s} \) increases when you solve a puzzle faster than the average and when the puzzle is difficult (as measured by solve time).
        This score is computed independently of recency.
        {% endblocktrans %}
    </p>

    <table class="table table-sm table-bordered w-auto mx-auto my-4">
        <thead class="table-light">
        <tr>
            <th>{% trans "Symbol" %}</th>
            <th>{% trans "Meaning" %}</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>\( \bar{t}_s \)</td>
            <td>{% trans "Average solve time for puzzle \(s\)" %}</td>
        </tr>
        <tr>
            <td>\( t_{u,s} \)</td>
            <td>{% trans "Your time to solve puzzle \(s\)" %}</td>
        </tr>
        </tbody>
    </table>

    <hr class="my-4">

    <h6 class="fw-bold mb-2">{% trans "Recency weight" %}</h6>
    <p>
        {% blocktrans %}
        To value recent solves more highly, each puzzle’s score is assigned a time-based weight:
        {% endblocktrans %}
    </p>
    <div class="text-center mb-4">
        <p class="text-primary">\[\displaystyle w(\Delta_s) = \alpha^{\Delta_s} \quad \text{with } \alpha = 0.95\]</p>
    </div>

    <p>
        {% blocktrans %}
        Where \( \Delta_s \) is the number of days since the solve. Older solves contribute less over time.
        {% endblocktrans %}
    </p>

    <hr class="my-4">

    <h6 class="fw-bold mb-2">{% trans "User rating" %}</h6>
    <p>
        {% blocktrans %}
        Your overall rating \( R_u \) is computed as a <em>weighted geometric mean</em> of your per-puzzle rewards \( S_{u,s} \),
        using recency weights:
        {% endblocktrans %}
    </p>

    <div class="text-center mb-3">
        <p class="text-primary">\[\displaystyle R_u = \exp\left( \frac{ \sum_{s \in S_u} w(\Delta_s) \cdot \ln(S_{u,s}) }{ \sum_{s \in S_u} w(\Delta_s) } \right)\]</p>
    </div>

    <p>
        {% blocktrans %}
        This form ensures stability and avoids excessive numerical divisions by computing the weighted sum of logs before dividing by the total weight.
        {% endblocktrans %}
    </p>

    <hr class="my-4">

    <h6 class="fw-bold mb-2">{% trans "Volume weight" %}</h6>
    <p>
        {% blocktrans %}
        To avoid inflation from a single good solve, your final rating is scaled by a <em>volume weight</em> based on how many puzzles you've solved recently:
        {% endblocktrans %}
    </p>

    <div class="text-center mb-4">
        <p class="text-primary">\[\displaystyle V_u = 1 - e^{-\lambda N_u} \quad \text{with } \lambda = 0.2\]</p>
        <p class="text-primary">\[\displaystyle R'_u = R_u \cdot V_u\]</p>
    </div>

    <p>
        {% blocktrans %}
        This ensures that your rating becomes reliable only with consistent activity and performance.
        {% endblocktrans %}
    </p>

    <hr class="my-4">

    <h6 class="fw-bold mb-2">{% trans "Leaderboard score" %}</h6>
    <p>
        {% blocktrans %}
        To compare ratings across players, we normalize all adjusted ratings \( R'_u \) onto a 0–100 scale.
        The top player's score is always 100:
        {% endblocktrans %}
    </p>
    <div class="text-center mb-4">
        <p class="text-primary">\[\displaystyle \text{SPI}_u = 100 \cdot \frac{R'_u}{\max\limits_v R'_v}\]</p>
    </div>

    <p>
        {% blocktrans %}
        Everyone else is scored proportionally. A strong performance today can lift you up quickly —
        but you’ll need consistency to stay on top.
        {% endblocktrans %}
    </p>
</div>
